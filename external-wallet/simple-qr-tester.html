<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple QR Code Tester</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .qr-item { border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0; }
        .format-title { font-weight: bold; color: #007bff; margin-bottom: 10px; font-size: 18px; }
        .data-preview { background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 14px; word-break: break-all; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 16px; }
        button:hover { background: #0056b3; }
        .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .qr-container { margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Simple QR Code Tester</h1>
        
        <div class="info">
            <strong>üéØ Goal:</strong> Find which QR code format your wallet app can scan<br>
            Try each format below until you find one that works!
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è Can't see QR codes?</strong><br>
            The online QR generator might be blocked. Use the manual data below instead.
        </div>

        <!-- Format 1: Simple URL -->
        <div class="qr-item">
            <div class="format-title">1. Simple URL Format (Most Compatible)</div>
            <div class="qr-container">
                <img id="qr1" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=http://localhost:3001/api/auth/verify?challenge=test_challenge_123&employee=zaid&address=0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315" alt="QR Code 1">
            </div>
            <div class="data-preview">http://localhost:3001/api/auth/verify?challenge=test_challenge_123&employee=zaid&address=0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315</div>
            <button onclick="copyText('http://localhost:3001/api/auth/verify?challenge=test_challenge_123&employee=zaid&address=0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315')">Copy URL</button>
        </div>

        <!-- Format 2: Plain Text -->
        <div class="qr-item">
            <div class="format-title">2. Plain Text Format</div>
            <div class="qr-container">
                <img id="qr2" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=test_challenge_123" alt="QR Code 2">
            </div>
            <div class="data-preview">test_challenge_123</div>
            <button onclick="copyText('test_challenge_123')">Copy Text</button>
        </div>

        <!-- Format 3: URI Scheme -->
        <div class="qr-item">
            <div class="format-title">3. Custom URI Scheme</div>
            <div class="qr-container">
                <img id="qr3" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=did:auth:challenge=test_challenge_123&employee=zaid&api=http://localhost:3001/api/auth/verify" alt="QR Code 3">
            </div>
            <div class="data-preview">did:auth:challenge=test_challenge_123&employee=zaid&api=http://localhost:3001/api/auth/verify</div>
            <button onclick="copyText('did:auth:challenge=test_challenge_123&employee=zaid&api=http://localhost:3001/api/auth/verify')">Copy URI</button>
        </div>

        <!-- Format 4: JSON -->
        <div class="qr-item">
            <div class="format-title">4. JSON Format (Our Current)</div>
            <div class="qr-container">
                <img id="qr4" src='https://api.qrserver.com/v1/create-qr-code/?size=200x200&data={"challenge":"test_challenge_123","employee":"zaid","address":"0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315","api":"http://localhost:3001/api/auth/verify"}' alt="QR Code 4">
            </div>
            <div class="data-preview">{"challenge":"test_challenge_123","employee":"zaid","address":"0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315","api":"http://localhost:3001/api/auth/verify"}</div>
            <button onclick="copyJSON()">Copy JSON</button>
        </div>

        <div class="info">
            <h3>üß™ Testing Instructions:</h3>
            <ol>
                <li><strong>Scan each QR code</strong> with your wallet app</li>
                <li><strong>Note which format works</strong> (doesn't show "unsupported")</li>
                <li><strong>Tell me the working format number</strong> (1, 2, 3, or 4)</li>
                <li><strong>I'll update our portal</strong> to use that format</li>
            </ol>
        </div>

        <div class="warning">
            <h3>üì± What Your App Should Do:</h3>
            <p><strong>After scanning:</strong></p>
            <ul>
                <li>Extract the challenge: <code>test_challenge_123</code></li>
                <li>POST to: <code>http://localhost:3001/api/auth/verify</code></li>
                <li>Include: challenge, signature ("demo_signature_for_development"), and your address</li>
            </ul>
        </div>

        <h3>üîß Manual Testing (if QR doesn't work):</h3>
        <button onclick="testBackendDirect()">Test Backend Directly</button>
        <div id="testResult"></div>
    </div>

    <script>
        function copyJSON() {
            const jsonText = '{"challenge":"test_challenge_123","employee":"zaid","address":"0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315","api":"http://localhost:3001/api/auth/verify"}';
            copyText(jsonText);
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Copied to clipboard!');
            }).catch(err => {
                prompt('Copy this text:', text);
            });
        }

        async function testBackendDirect() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<p>Testing backend connection...</p>';
            
            try {
                // Test health first
                const healthResponse = await fetch('http://localhost:3001/api/health');
                const healthData = await healthResponse.json();
                
                // Test challenge generation
                const challengeResponse = await fetch('http://localhost:3001/api/auth/challenge', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employee: 'zaid' })
                });
                const challengeData = await challengeResponse.json();
                
                // Test authentication
                const authResponse = await fetch('http://localhost:3001/api/auth/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        challenge: challengeData.data.challenge,
                        signature: 'demo_signature_for_development',
                        address: '0xF51b2A9f6E125B7643CD0230c7140Bc4b9a27315'
                    })
                });
                const authData = await authResponse.json();
                
                resultDiv.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h4>‚úÖ Backend Test Results:</h4>
                        <p><strong>Health:</strong> ${healthData.message}</p>
                        <p><strong>Challenge:</strong> ${challengeData.data.challenge}</p>
                        <p><strong>Auth:</strong> ${authData.success ? 'Success' : 'Failed'}</p>
                        <p><strong>Employee:</strong> ${authData.data?.employee?.name || 'Unknown'}</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h4>‚ùå Backend Test Failed:</h4>
                        <p>${error.message}</p>
                        <p>Make sure the backend is running on port 3001</p>
                    </div>
                `;
            }
        }

        // Check if images load properly
        window.onload = function() {
            const images = document.querySelectorAll('img[id^="qr"]');
            images.forEach((img, index) => {
                img.onerror = function() {
                    this.style.display = 'none';
                    this.parentNode.innerHTML += '<p style="color: red;">QR image failed to load. Use the copy button to get the data manually.</p>';
                };
            });
        };
    </script>
</body>
</html>
